"use strict";angular.module("qaApp",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/setting",{templateUrl:"views/setting.html",controller:"SettingCtrl"}).when("/help",{templateUrl:"views/help.html",controller:"HelpCtrl"}).when("/financical",{templateUrl:"views/financical.html",controller:"FinancicalCtrl"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.responseInterceptors.push("errorHttpInterceptor")}]),angular.module("qaApp").controller("LoginCtrl",["$scope","errorService","$location","accountAPIservice",function(a,b,c,d){a.errorService=b,a.coverEffect=!0,a.login={},a.loadingClosed=!0,a.checkUser=function(){a.loadingClosed=!1;var b={};return b.email=a.login.userEmail,b.password=a.login.userPassword,void 0===b.email||void 0===b.password?(console.log("please enter email or password"),!1):void d.authorize(b,function(){c.path("/main")},function(){console.log("failed to login")})},a.addUser=function(){console.log("addUser click"),a.loadingClosed=!1;var b=a.login.userEmail,e=a.login.userPassword;return void 0===b||void 0===e?(console.log("please enter email or password"),!1):void d.addAccount(b,e).success(function(b){return a.loadingClosed=!0,0===b?c.path("/main"):void console.log(500===b?"create error":"Unknown error")}).error(function(){a.loadingClosed=!0,console.log("register error...")})},a.sendEmail=function(){a.lodingClosed=!1;var b=a.forgetEmail;return void 0===b?!1:void d.forgetCode(b).success(function(b){a.lodingClosed=!0,0===b?a.sendEmailSuccess=!0:500===b&&(a.sendEmailError=!0)}).error(function(){a.lodingClosed=!0,a.internetError=!0})}}]),angular.module("qaApp").controller("MainCtrl",["$scope","$rootScope","$location","robotListService",function(a,b,c,d){a.$on("loginRequired",function(){console.log("event loginRequired")}),a.btns=[{name:"信息"},{name:"管理员"},{name:"代码"}],d.getRobotList(function(b){a.robotList=b}),a.showRobotModal=function(b){a.theStatusForSave="show",a.robotId=this.$parent.$index,a.theEditingRobot=angular.copy(this.$parent.robot),a.popModal(),0===b?a.tabInfoShowing=!0:1===b?a.tabManegerShowing=!0:2===b&&(a.tabCodeShowing=!0)},a.addRobotModal=function(){a.theStatusForSave="add",a.theEditingRobot=void 0,a.popModal(),a.tabInfoShowing=!0},a.saveInfoData=function(){a.modifiedRobot=a.theEditingRobot,"show"===a.theStatusForSave?d.updateInfoSetting(a.modifiedRobot,function(){a.closeRobotModal(),a.robotList[a.robotId]=a.modifiedRobot},function(){console.log("error")}):"add"===a.theStatusForSave&&d.addRobot(a.modifiedRobot,function(){a.closeRobotModal(),a.robotList.push(a.modifiedRobot)},function(){console.log("error")})}}]),angular.module("qaApp").controller("SettingCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("HelpCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("FinancicalCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("LogoutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").service("robotListService",["$rootScope","$http","authHttp",function(a,b,c){var d={},e="/test-data/robotListData.json",f="/test-data/robotListNewData.json",g="/test-data/robotListData.json";return d.setRobotList=function(a){d.robotList=a},d.getRobotList=function(a,b){c.get(e).success(function(b){a(b)}).error(b)},d.updateInfoSetting=function(a,b,d){c.get(f,a).success(function(){b()}).error(d)},d.addRobot=function(a,b,d){c.get(g,a).success(function(){b()}).error(d)},d}]),angular.module("qaApp").service("accountAPIservice",["$http","AuthenticationService",function(a,b){var c={},d="/test-data/user.json";return c.checkAccount=function(b,c){return a({method:"GET",url:d+"?"+b+"&"+c})},c.addAccount=function(b,c){return a({method:"GET",url:d+"?"+b+"&"+c})},c.forgetCode=function(b){return a({method:"GET",url:d+"?"+b})},c.authorize=function(c,d,e){a.get("/test-data/user.json?"+c.email+"&"+c.password).success(function(a){b.setToken(a.token),d()}).error(e)},c}]),angular.module("qaApp").directive("loading-img",function(){return{template:'<img id="loading" ng-hide="loadingClosed" src="images/loader.gif">',restrict:"A",replace:!0,link:function(){var a=document.getElementById("loading");a.style.top=(window.innerHeight-16)/2+"px",a.style.left=(window.innerWidth-16)/2+"px"}}}),angular.module("qaApp").directive("login",["$http",function(a){return{templateUrl:"views/template/login-btn.html",restrict:"E",replace:!0,link:function(b){b.ensureEmailUnique=function(){var c;"forgetCode"===b.anotherState?c=b.forgetCode.email:("register"===b.state||"login"===b.state)&&(c=b.login.userEmail),void 0===c||a({method:"GET",url:"/test-data/user.json?"+c}).success(function(a){a.email!==c?(b.hasRepeat=!1,"register"===b.state?b.showImg=!0:("login"===b.state||"forgetCode"===b.state)&&(b.showImg=!1)):a.email===c&&(b.hasRepeat=!0,"register"===b.state?b.showImg=!1:("login"===b.state||"forgetCode"===b.state)&&(b.showImg=!0))})},b.state="register",b.switchToLogin=function(){b.state="login",b.hasRepeat===!0?b.showImg=!0:b.hasRepeat===!1&&(b.showImg=!1)},b.switchToRegister=function(){b.state="register",b.hasRepeat===!0?b.showImg=!1:b.hasRepeat===!1&&(b.showImg=!0)},b.forgetCode=function(){b.anotherState="forgetCode",b.hasRepeat=void 0,b.modalOpened=!0,b.sendEmailSuccess=!1,b.forgetCodeClicked=!0},b.modalClosed=function(){b.forgetCodeClicked=!1,b.modalOpened=!1,b.anotherState=""},b.returnLogin=function(){b.state="login",b.modalClosed()},b.returnRegister=function(){b.state="register",b.modalClosed()}}}}]),angular.module("qaApp").directive("navbar",function(){return{templateUrl:"views/template/navbar.html",restrict:"A",link:function(a){a.showMenu=function(){a.menuIsShowing=!a.menuIsShowing}}}}),angular.module("qaApp").directive("ensureEmailUnique",["$http",function(a){return{require:"ngModel",link:function(b,c,d){b.$watch(d.ngModel,function(){var c;"forgetCode"===b.anotherState?c=b.forgetCode.email:("register"===b.state||"login"===b.state)&&(c=b.login.userEmail),void 0===c||a({method:"GET",url:"/test-data/user.json?"+c}).success(function(a){a.email!==c?(b.hasRepeat=!1,"register"===b.state?b.showImg=!0:("login"===b.state||"forgetCode"===b.state)&&(b.showImg=!1)):a.email===c&&(b.hasRepeat=!0,"register"===b.state?b.showImg=!1:("login"===b.state||"forgetCode"===b.state)&&(b.showImg=!0))})})}}}]),angular.module("qaApp").directive("robotModal",function(){return{templateUrl:"views/template/robot-modal.html",restrict:"A",link:function(a){a.popModal=function(){a.modalOpened=!0,a.modalIsShowing=!0},a.closeRobotModal=function(){a.modalIsShowing=!1,a.modalOpened=!1,a.tabInfoShowing=!1,a.tabManegerShowing=!1,a.tabCodeShowing=!1,a.theEditingRobot=void 0,a.infoForm.$setPristine()},a.showTabInfo=function(){a.tabManegerShowing=!1,a.tabCodeShowing=!1,a.tabInfoShowing=!0},a.showTabManager=function(){a.tabCodeShowing=!1,a.tabInfoShowing=!1,a.tabManegerShowing=!0},a.showTabCode=function(){a.tabInfoShowing=!1,a.tabManegerShowing=!1,a.tabCodeShowing=!0}}}}),angular.module("qaApp").directive("robotModalTabInformation",function(){return{templateUrl:"views/template/robot-information.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("robotModalTabManager",function(){return{templateUrl:"views/template/robot-manager.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("robotModalTabGetCode",function(){return{templateUrl:"views/template/robot-getcode.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("checkInput",function(){return{require:"ngModel",link:function(a,b,c){a.$watch(c.ngModel,function(){a.login.passwordError=!1})}}}),angular.module("qaApp").service("errorService",function(){return{errorMessage:null,setError:function(a){this.errorMessage=a},clear:function(){this.errorMessage=null}}}),angular.module("qaApp").directive("alertBar",["$parse",function(a){return{restrict:"A",template:'<div class="alert alert-error alert-bar" ng-show="errorMessage"><button type="button" class="close" ng-click="hideAlert()"</button>{{errorMessage}}</div>',link:function(b,c,d){var e=d["alert.message"];b.errorMessage=null,b.$watch(e,function(a){b.errorMessage=a}),b.hideAlert=function(){b.errorMessage=null,a(e).assign(b,null)}}}}]),angular.module("qaApp").service("errorHttpInterceptor",["$q","$location","errorService","$rootScope",function(a,b,c,d){return function(e){return e.then(function(a){return a},function(e){return 401===e.status?(console.log("401"),d.$broadcast("loginRequired"),b.path("/login")):e.status>=400&&e.status<500&&(console.log("400---500"),c.setError("Service was unable to find what you were looking for... Sorry!!")),a.reject(e)})}}]),angular.module("qaApp").service("authHttp",["$http","AuthenticationService",function(a,b){var c={},d=function(a){a.headers=a.headers||{},a.headers.Authorization=b.getTokenType()+" "+b.getAccessToken()};return angular.forEach(["get","delete","head","jsonp"],function(b){c[b]=function(c,e){return e=e||{},d(e),a[b](c,e)}}),angular.forEach(["post","put"],function(b){c[b]=function(c,e,f){return f=f||{},d(f),a[b](c,e,f)}}),c}]),angular.module("qaApp").service("AuthenticationService",function(){var a;return{setToken:function(b){return a||(a=b),a},getTokenType:function(){return"version1"},getAccessToken:function(){return a}}});