"use strict";angular.module("qaApp",["ngRoute","angularFileUpload"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/setting",{templateUrl:"views/setting.html",controller:"SettingCtrl"}).when("/help",{templateUrl:"views/help.html",controller:"HelpCtrl"}).when("/financical",{templateUrl:"views/financical.html",controller:"FinancicalCtrl"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.responseInterceptors.push("errorHttpInterceptor")}]),angular.module("qaApp").controller("LoginCtrl",["$scope","errorService","$location","accountAPIservice",function(a,b,c,d){a.errorService=b,a.coverEffect=!0,a.checkEmail=function(){a.emailAfterBlur=!0},a.hideEmailError=function(){a.emailAfterBlur=!1},a.checkPassword=function(){a.passwordAfterBlur=!0},a.hidePasswordError=function(){a.passwordAfterBlur=!1},a.changeCaptcha=function(){d.captcha(function(b){a.captchaSrc=b},function(){console.log("captcha error")})},a.checkAgain=function(){a.checkEmail(),a.checkPassword()},a.addUser=function(){if(a.checkAgain(),a.registerForm.email.$invalid||a.registerForm.password.$invalid)return!1;var b={};b.email=a.userEmail,b.password=a.userPassword,d.register(b,function(a){"0"===a.errno&&c.path("/main")},function(){console.log("error")})},a.checkUser=function(){if(a.checkAgain(),a.registerForm.account.$invalid||a.registerForm.password.$invalid)return!1;var b={};b.email=a.userAccount,b.password=a.userPassword,b.captcha=a.userCaptcha,void 0===a.remeberMe||a.remeberMe===!1?b.auto_login=0:a.remeberMe===!0&&(b.auto_login=1),d.login(b,function(a){"0"===a.errno&&c.path("/main")},function(){console.log("error")})},a.sendEmail=function(){if(a.checkForgetError(),a.forgetCodeForm.$invalid)return!1;var b=a.forgetCodeEmail;d.forgetCode(b).success(function(b){0===b?a.sendEmailSuccess=!0:500===b&&(a.sendEmailError=!0)}).error(function(){a.internetError=!0})}}]),angular.module("qaApp").controller("MainCtrl",["$scope","$upload","$location","robotListService",function(a,b,c,d){a.$on("loginRequired",function(){console.log("event loginRequired")}),a.btns=[{name:"信息"},{name:"管理员"},{name:"代码"}],d.getRobotList(function(b){a.robotList=b}),a.showRobotModal=function(b){a.theStatusForSave="show",a.robotId=this.$parent.$index,a.theEditingRobot=angular.copy(this.$parent.robot),a.popModal(),0===b?a.tabInfoShowing=!0:1===b?a.tabManegerShowing=!0:2===b&&(a.tabCodeShowing=!0)},a.addRobotModal=function(){a.theStatusForSave="add",a.theEditingRobot=void 0,a.popModal(),a.tabInfoShowing=!0},a.saveInfoData=function(){a.modifiedRobot=a.theEditingRobot,"show"===a.theStatusForSave?d.updateInfoSetting(a.modifiedRobot,function(){a.closeRobotModal(),a.robotList[a.robotId]=a.modifiedRobot},function(){console.log("update error")}):"add"===a.theStatusForSave&&d.addRobot(a.modifiedRobot,function(){a.closeRobotModal(),a.robotList.push(a.modifiedRobot)},function(){console.log("add error")})},a.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d];a.upload=b.upload({url:"test-data/",data:{myObj:a.myModelObj},file:e})}}}]),angular.module("qaApp").controller("SettingCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("HelpCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("FinancicalCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").controller("LogoutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("qaApp").service("robotListService",["$rootScope","$http","authHttp",function(a,b,c){var d={},e="/test-data/robotListData.json",f="/test-data/robotListNewData.json",g="/test-data/robotListData.json";return d.setRobotList=function(a){d.robotList=a},d.getRobotList=function(a,b){c.get(e).success(function(b){a(b)}).error(b)},d.updateInfoSetting=function(a,b,d){c.get(f,a).success(function(){b()}).error(d)},d.addRobot=function(a,b,d){c.get(g,a).success(function(){b()}).error(d)},d}]),angular.module("qaApp").service("accountAPIservice",["$http",function(a){var b={},c="/test-data/email.json?",d="/test-data/user.json?",e="/test-data/captcha.json?";return b.login=function(b,d,e){a.post(c+b).success(function(a){d(a)}).error(e)},b.register=function(b,c,e){a.post(d+b).success(function(a){c(a)}).error(e)},b.captcha=function(b,c){var d=Math.random();a.get(e+d).success(function(a){b(a)}).error(c)},b}]),angular.module("qaApp").service("errorHttpInterceptor",["$q","$location","errorService","$rootScope",function(a,b,c,d){return function(e){return e.then(function(a){return a},function(e){return 401===e.status?(console.log("401"),d.$broadcast("loginRequired"),b.path("/login")):e.status>=400&&e.status<500&&(console.log("400---500"),c.setError("Service was unable to find what you were looking for... Sorry!!")),a.reject(e)})}}]),angular.module("qaApp").service("errorService",function(){return{errorMessage:null,setError:function(a){this.errorMessage=a},clear:function(){this.errorMessage=null}}}),angular.module("qaApp").service("authHttp",["$http","AuthenticationService",function(a,b){var c={},d=function(a){a.headers=a.headers||{},a.headers.Authorization=b.getTokenType()+" "+b.getAccessToken()};return angular.forEach(["get","delete","head","jsonp"],function(b){c[b]=function(c,e){return e=e||{},d(e),a[b](c,e)}}),angular.forEach(["post","put"],function(b){c[b]=function(c,e,f){return f=f||{},d(f),a[b](c,e,f)}}),c}]),angular.module("qaApp").service("AuthenticationService",function(){var a;return{setToken:function(b){return a||(a=b),a},getTokenType:function(){return"version1"},getAccessToken:function(){return a}}}),angular.module("qaApp").directive("loading-img",function(){return{template:'<img id="loading" ng-hide="loadingClosed" src="images/loader.gif">',restrict:"A",replace:!0,link:function(){var a=document.getElementById("loading");a.style.top=(window.innerHeight-16)/2+"px",a.style.left=(window.innerWidth-16)/2+"px"}}}),angular.module("qaApp").directive("login",function(){return{templateUrl:"views/template/login-btn.html",restrict:"E",replace:!0,link:function(a){a.state="register",a.switchToLogin=function(){a.state="login",a.userPassword=void 0,a.emailAfterBlur=!1,a.passwordAfterBlur=!1},a.switchToRegister=function(){a.state="register",a.userPassword=void 0,a.emailAfterBlur=!1,a.passwordAfterBlur=!1},a.forgetCode=function(){a.forgetCodeEmail="",a.loseFocus=!1,a.modalOpened=!0,a.forgetCodeClicked=!0},a.modalClosed=function(){a.forgetCodeClicked=!1,a.modalOpened=!1},a.checkForgetError=function(){a.loseFocus=!0},a.hideForgetError=function(){a.loseFocus=!1},a.returnToLogin=function(){a.state="login",a.modalClosed()},a.returnToRegister=function(){a.state="register",a.modalClosed()}}}}),angular.module("qaApp").directive("navbar",function(){return{templateUrl:"views/template/navbar.html",restrict:"A",link:function(a){a.showMenu=function(){a.menuIsShowing=!a.menuIsShowing}}}}),angular.module("qaApp").directive("robotModal",function(){return{templateUrl:"views/template/robot-modal.html",restrict:"A",link:function(a){a.popModal=function(){a.modalOpened=!0,a.modalIsShowing=!0},a.closeRobotModal=function(){a.modalIsShowing=!1,a.modalOpened=!1,a.tabInfoShowing=!1,a.tabManegerShowing=!1,a.tabCodeShowing=!1,a.theEditingRobot=void 0,a.infoForm.$setPristine()},a.showTabInfo=function(){a.tabManegerShowing=!1,a.tabCodeShowing=!1,a.tabInfoShowing=!0},a.showTabManager=function(){a.tabCodeShowing=!1,a.tabInfoShowing=!1,a.tabManegerShowing=!0},a.showTabCode=function(){a.tabInfoShowing=!1,a.tabManegerShowing=!1,a.tabCodeShowing=!0}}}}),angular.module("qaApp").directive("robotModalTabInformation",function(){return{templateUrl:"views/template/robot-information.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("robotModalTabManager",function(){return{templateUrl:"views/template/robot-manager.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("robotModalTabGetCode",function(){return{templateUrl:"views/template/robot-getcode.html",restrict:"A",replace:!0}}),angular.module("qaApp").directive("alertBar",["$parse",function(a){return{restrict:"A",template:'<div class="alert alert-error alert-bar" ng-show="errorMessage"><button type="button" class="close" ng-click="hideAlert()"</button>{{errorMessage}}</div>',link:function(b,c,d){var e=d["alert.message"];b.errorMessage=null,b.$watch(e,function(a){b.errorMessage=a}),b.hideAlert=function(){b.errorMessage=null,a(e).assign(b,null)}}}}]);